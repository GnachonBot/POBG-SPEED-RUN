<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PUBG Run Overlay</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: rgba(50,50,50,0.85); /* slightly colored overlay background */
      color: #f8f8f8;
      font-size: 14px;
      padding: 10px;
    }
    .container {
      background: rgba(40,40,40,0.9); /* full overlay background */
      padding: 10px;
      border-radius: 8px;
    }
    .splits {
      display: grid;
      grid-template-columns: 50px 70px 70px 60px;
      gap: 3px 6px;
      align-items: center;
    }
    .header {
      font-weight: bold;
      border-bottom: 2px solid #d28f28;
      margin-bottom: 3px;
      display: grid;
      grid-template-columns: 50px 70px 70px 60px;
      font-size: 13px;
    }
    .total {
      margin-top: 5px;
      border-top: 2px solid #d28f28;
      padding-top: 3px;
      display: grid;
      grid-template-columns: 50px 70px 70px 60px;
      font-weight: bold;
      color: #d28f28;
      font-size: 13px;
    }
    input, textarea {
      background: rgba(0,0,0,0.7);
      border: 1px solid #555;
      color: #fff;
      width: 100%;
      text-align: center;
      padding: 2px;
      border-radius: 4px;
      font-size: 13px;
    }
    .label {
      font-weight: bold;
      color: #ffb84d;
      font-size: 13px;
    }
    .diff {
      font-weight: bold;
      font-size: 13px;
      text-align: right;
    }
    .ahead { color: #00ff00; }
    .behind { color: #ff4444; }
    .gold { color: #ffd700; }
    .textbox {
      margin-top: 8px;
      width: 100%;
      height: 60px;
      resize: none;
    }
    .button {
      margin-top: 5px;
      background: #d28f28;
      border: none;
      color: #000;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 5px;
    }
    .button:hover {
      background: #ffb84d;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>Split</div>
    <div>Time</div>
    <div>Best</div>
    <div>Δ</div>
  </div>

  <div id="split-list" class="splits"></div>

  <div class="total">
    <div>Total</div>
    <div id="current-total">0:00</div>
    <div id="best-total">0:00</div>
    <div id="diff-total">0:00</div>
  </div>

  <button class="button" onclick="resetCurrentTimes()">Reset Current Times</button>
<button class="button" onclick="setNachoBest()">Set Nacho Best</button>
</div>

<script>
const splitNames = ["K1","K2","V1","V2","S1","S2","M1","M2","P1","P2","E1","END"];
const splits = splitNames.map(name => ({ name, current: "", best: "", diff: "" }));

function renderSplits() {
  const list = document.getElementById("split-list");
  list.innerHTML = "";
  splits.forEach((s, idx) => {
    const label = document.createElement("div");
    label.textContent = s.name;
    label.className = "label";

    const currentInput = document.createElement("input");
    currentInput.value = s.current;
    currentInput.placeholder = "0:00";
    currentInput.addEventListener("input", () => { splits[idx].current = currentInput.value; updateTotals(); updateBestTextbox(); });
    currentInput.id = `current-${idx}`;

    const bestInput = document.createElement("input");
    bestInput.value = s.best;
    bestInput.placeholder = "0:00";
    bestInput.addEventListener("input", () => { splits[idx].best = bestInput.value; updateTotals(); updateBestTextbox(); });
    bestInput.id = `best-${idx}`;

    const diffDiv = document.createElement("div");
    diffDiv.className = "diff";
    diffDiv.id = `diff-${idx}`;
    diffDiv.textContent = "";

    list.appendChild(label);
    list.appendChild(currentInput);
    list.appendChild(bestInput);
    list.appendChild(diffDiv);
  });
}

function updateTotals() {
  let lastBest = 0;
  let lastCurrent = 0;
  splits.forEach((s, idx) => {
    const current = toSeconds(s.current);
    const best = toSeconds(s.best);
    const currentCumulative = current || lastCurrent;
    const bestCumulative = best || lastBest;
    const diffDiv = document.getElementById(`diff-${idx}`);
    if(currentCumulative && bestCumulative) {
      const diff = currentCumulative - bestCumulative;
      s.diff = diff;
      diffDiv.textContent = formatSigned(diff);
      diffDiv.className = "diff " + diffClass(diff);
    } else diffDiv.textContent = "";
    lastCurrent = currentCumulative;
    lastBest = bestCumulative;
  });
  document.getElementById("current-total").textContent = formatTime(lastCurrent);
  document.getElementById("best-total").textContent = formatTime(lastBest);
  document.getElementById("diff-total").textContent = formatSigned(lastCurrent - lastBest);
}

function updateBestTextbox() {
  document.getElementById("best-textbox").value = splits.map(s => s.best).join(",");
}

function parseBestTextbox() {
  const val = document.getElementById("best-textbox").value;
  const times = val.split(",").map(t => t.trim());
  splits.forEach((s, idx) => {
    if(times[idx]) {
      s.best = times[idx];
      document.getElementById(`best-${idx}`).value = times[idx];
    }
  });
  updateTotals();
}

function resetCurrentTimes() {
  splits.forEach((s, idx) => {
    s.current = "";
    document.getElementById(`current-${idx}`).value = "";
  });
  updateTotals();
}

function updateBestIfBeaten() {
  splits.forEach((s, idx) => {
    const currentSec = toSeconds(s.current);
    const bestSec = toSeconds(s.best);
    if(currentSec > 0 && (bestSec === 0 || currentSec < bestSec)) {
      s.best = s.current;
      document.getElementById(`best-${idx}`).value = s.current;
    }
  });
  updateTotals();
  updateBestTextbox();
}

function updateRecordIfFullRunBeaten() {
  const currentTotal = splits.reduce((sum, s) => sum + toSeconds(s.current), 0);
  const recordTotal = splits.reduce((sum, s) => sum + toSeconds(s.best), 0);
  if(currentTotal < recordTotal || recordTotal === 0) {
    document.getElementById("record-textbox").value = splits.map(s => s.current).join(",");
  }
}

function toSeconds(t){ if(!t) return 0; const parts=t.split(":").map(Number); if(parts.length===2) return parts[0]*60+parts[1]; return 0; }
function formatTime(sec){ const m=Math.floor(sec/60); const s=sec%60; return `${m}:${s.toString().padStart(2,'0')}`; }
function formatSigned(sec){ if(sec===0) return "±0"; const sign=sec<0?"-":"+"; return `${sign}${formatTime(Math.abs(sec))}`; }
function diffClass(diff){ if(diff<-10)return"gold"; if(diff<0)return"ahead"; if(diff>0)return"behind"; return""; }

renderSplits(); updateTotals(); updateBestTextbox();

document.getElementById("best-textbox").addEventListener("change", parseBestTextbox);

function setNachoBest() {
  const nachoTimes = ["0:53","2:00","2:56","4:26","5:30","6:59","7:53","9:08","10:35","12:38","13:34","15:07"];
  splits.forEach((s, idx) => {
    s.best = nachoTimes[idx] || "";
    document.getElementById(`best-${idx}`).value = s.best;
  });
  updateTotals();
  updateBestTextbox();
}

</script>
</body>
</html>
